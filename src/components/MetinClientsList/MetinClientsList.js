import { Box, Card, CardContent, CardMedia, Grid, LinearProgress, Typography } from '@material-ui/core';
import React                                                                   from "react"
import { withRouter }                                                          from 'react-router-dom'
import blank_image                                                             from '../../images/blank-class-image.png'
import sura                                                                    from '../../images/characters/Sura.png'
import store                                                                   from "../../store";
import { ACTIONS }                                                             from '../../utils/enums.js'
import { getNiceLookingStringFromMapName }                                     from '../../utils/functions.js'

class MetinClientsList extends React.Component {
    constructor( props ) {
        super(props)

    }

    render() {
        return (
            this.props.clients.map(( client, i ) => {
                return <Grid item xs={ 2 } sm={ 4 } md={ 4 } key={ i }>
                    <MetinClient client={ client } id={ i } history={ this.props.history } socket={ this.props.socket }
                                 language={ this.props.language }/>
                </Grid>
            })
        )
    }
}

class MetinClient extends React.Component {
    constructor( props ) {
        super(props)
    }

    handleClickOnClient = ( client ) => {
        let language = store.getState().languageReducer.language_type
        store.dispatch({ type: ACTIONS.SELECT_CLIENT, payload: client })
        store.dispatch({
            type: ACTIONS.GET_FULL_SERVER_STATUS,
            payload: { client: this.props.socket, index: client.id, language: language }
        })
        const { history } = this.props;
        if ( history ) history.push('/client');
    }

    render = () => {
        if ( this.props.client.player_name !== 'None' ) {
            return (
                <Card onClick={ () => this.handleClickOnClient(this.props.client) }>
                    <CardMedia
                        component={ "img" }
                        src={ sura }
                        alt={ "sura" }
                        onError={ blank_image }
                    >
                    </CardMedia>
                    <CardContent>
                        <Typography gutterBottom variant={ "h5" }>
                            { this.props.client.player_name } ({ this.props.client.player_level })
                        </Typography>
                        <Typography>
                            { getNiceLookingStringFromMapName(this.props.client.player_curr_map) } ({ Math.round(this.props.client.player_position[0] / 100) }, { Math.round(this.props.client.player_position[1] / 100) })
                        </Typography>
                        <Box sx={ { display: 'flex' } }>
                            <Box sx={ { width: '100%', mt: 1 } }>
                                <LinearProgress variant="determinate"
                                                value={ Math.round(( this.props.client.player_experience / this.props.client.player_max_experience ) * 100) }/>
                                <Typography variant="body2" color="text.secondary">
                                    { this.props.language.exp } { this.props.client.player_experience }/{ this.props.client.player_max_experience } { Math.round(( this.props.client.player_experience / this.props.client.player_max_experience ) * 100) }%
                                </Typography>
                            </Box>
                        </Box>
                    </CardContent>
                </Card>
            )
        } else {
            return null
        }
    }

}

export default withRouter(MetinClientsList) 