import './register.css'
import React from 'react'
import { Button, Grid, Paper, TextField, Typography } from '@material-ui/core';
import { Link } from 'react-router-dom'
import Description from '../../components/login-register-desc/desc'
import { Redirect } from 'react-router';
import store from '../../store';

class Register extends React.Component {
    constructor(props){
        super(props)
        this.username = ''
        this.password = ''
        this.email = ''

        this.redirect = false

        this.handleOnUsernameChange = this.onUsernameChange.bind(this)
        this.handleOnPasswordChange = this.onPasswordChange.bind(this)
        this.handleOnEmailChange = this.onEmailChange.bind(this)
        this.handleOnRegisterButton = this.onRegisterButton.bind(this)
    }

    onUsernameChange(event) {
        this.username = event.target.value
    }

    onPasswordChange(event){
        this.password = event.target.value
    }
    
    onEmailChange(event){
        this.email = event.target.value
    }

    handleErrors(response) {
        if (!response.ok) {
            throw Error();
        }
        return response;
    }
    onRegisterButton(){
        let user_data = { 
            method: 'post',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: this.username, pass: this.password, email: this.email })}
            

        console.log(this.username, this.password)
        fetch('http://136.244.118.103/register', user_data).then(this.handleErrors).then(
             response => { 
                console.log(response.json())
                this.redirect = true
                this.forceUpdate()
            }).catch( error => {
                console.log(error)
            })
            
    }

    render () {
        if (this.redirect || store.getState().apiKey){
            return <Redirect to='/dashboard'/>
        }
        return (
            <Grid container id='container' maxWidth='Fluid' spacing={1}>
                <Grid item md={3}/>
                    <Description language={this.props.description_language}/>
                <Grid item xs={10} md={3} className="register-box">
                    <Paper className='register-display' variant='outlined' square>
                        <Grid item>
                            <div className='register-header'> {this.props.language.header} </div>
                        </Grid>
                        <form>
                        <Grid item>
                            <Grid item className='register-input'>
                                <TextField required label={this.props.language.label_username} helperText={this.props.language.label_username} onChange={ e=> this.handleOnUsernameChange(e)}/>
                            </Grid>
                            <Grid item className='register-input'>
                                <TextField required label={this.props.language.label_email} helperText={this.props.language.label_email_helper_text} nChange={ e=> this.handleOnEmailChange(e)}/>
                            </Grid>
                            <Grid item className='register-input'>
                                <TextField required label={this.props.language.label_password} helperText={this.props.language.label_password_helper_text} type='password' onChange={ e=> this.handleOnPasswordChange(e)}/>
                            </Grid>
                            <Grid item className='register-input'>
                                <Button variant='outlined' onClick={ ()=> this.handleOnRegisterButton()}> {this.props.language.sign_up} </Button>
                            </Grid>
                        </Grid>
                        <Grid item className='register-links'>
                            <Link to='/login'>
                                <Grid item className='link'>
                                    <Typography> {this.props.language.have_account} </Typography>
                                </Grid>
                            </Link>
                            <Link to='/password_reset'>
                            <Grid item className='link'>
                                <Typography> {this.props.language.forget_password} </Typography>
                            </Grid>
                            </Link>
                        </Grid>
                        </form>

                    </Paper>
                </Grid>
            </Grid>      
        );
    }
}

export default Register